<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人资料</title>
    <link type="text/css" href="../css/bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="../js/jquery-3.3.1.js"></script>
    <link type="text/css" rel="stylesheet" href="../css/xcConfirm.css">
    <script type="text/javascript" src="../js/xcConfirm.js"></script>
    <script type="text/javascript" src="../js/jquery.cookie.js"></script>
    <script type="text/javascript"src="../js/common.js"></script>
    <link rel="stylesheet" href="../css/app.css">
</head>
<body>
<nav class="navbar navbar-default" id="nav" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header" style="width: 60px; height: 60px;margin-left: 60px;" >
            <a href="index.html" id="index_id"><img src="../img/logo.jpg" style="height: 100%;width: 100%" class="img-circle"></a>
        </div>
        <div class="nav_btn">
            <button type="button" class="btn btn-primary btn-block">发现</button>
        </div>
        <div class="nav_btn">
            <button type="button" class="btn btn-primary btn-block">关注</button>
        </div>
        <div class="input-group search_input">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button">搜索</button>
            </span>
            <input type="text" class="form-control" placeholder="输入要查找文章">
        </div>
        <ul class="nav navbar-nav navbar-right nav_ul" id="user_info">
            <!--<a href="UserInfo.html">-->
                <!--<div class="navbar-header" style="width: 60px; height: 60px;float: left">-->
                    <!--<img src="../img/logo.jpg" style="height: 100%;width: 100%" class="img-circle">-->
                <!--</div>-->
                <!--<div style="width: 60px; height: 60px;float: left;line-height: 60px">-->
                    <!--<span>15682369546</span>-->
                <!--</div>-->
            <!--</a>-->
            <!--<div class="nav_btn">-->
                <!--<button type="button" class="btn btn-primary btn-block">写文章</button>-->
            <!--</div>-->
        </ul>
    </div>
</nav>
<div>
    <div class="user_info">
        <div class="tab_userinfo">
           <ul class="list-group">
               <li class="list-group-item" id="change_item_1">
                   <span class="glyphicon glyphicon-user"></span>
                   个人资料
               </li>
               <li class="list-group-item" id="change_item_2">
                   <span class="glyphicon glyphicon-lock"></span>
                   修改密码
               </li>
           </ul>
        </div>
        <div class="show_userinfo" id="order1">
            <div class="user_upload_head">
                <div class="head_img">
                    <a href="" id="head_img"></a>
                </div>
                <div class="edit_head">
                    <button class="btn btn-default">点击修改</button>
                </div>
            </div>
            <div class="user_detail_info">
                <form class="form-horizontal">
                    <div class="form-group user_detail_info_ev">
                        <label class="col-sm-3 control-label">昵称</label>
                        <div class="col-sm-9">
                            <input class="form-control" id="nickname" placeholder="输入你的昵称">
                        </div>
                    </div>
                    <div class="form-group user_detail_info_ev">
                        <label class="col-sm-3 control-label">性别</label>
                        <div class="col-sm-9" id="sex">
                            <label class="radio-inline">
                                <input type="radio" name="sex" value="M" checked="checked">男
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="sex" value="F" > 女
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-xs-offset-3 col-xs-6 has-feedback">
                            <button type="button" class="btn btn-primary btn-block" id="re_save" >保存</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="show_userinfo" id="order2" style="display: none">
            <div class="user_detail_info" style="padding-top: 0px">
                <form class="form-horizontal">
                    <div class="form-group user_detail_info_ev" style="padding-top: 0px">
                        <label class="col-sm-3 control-label">旧密码</label>
                        <div class="col-sm-9">
                            <input type="password" class="form-control" placeholder="输入旧的密码">
                        </div>
                    </div>
                    <div class="form-group user_detail_info_ev">
                        <label class="col-sm-3 control-label">新密码</label>
                        <div class="col-sm-9">
                            <input  type="password" class="form-control" placeholder="输入新的密码">
                        </div>
                    </div>
                    <div class="form-group user_detail_info_ev">
                        <label class="col-sm-3 control-label">确认密码</label>
                        <div class="col-sm-9">
                            <input type="password" class="form-control" placeholder="确认新的密码">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-xs-offset-3 col-xs-6 has-feedback">
                            <button type="button" class="btn btn-primary btn-block" id="save_edit" >确认修改</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    $(document).ready(function(){
        //首先获取导航栏距离浏览器顶部的高度
        var top = $('#nav').offset().top;
        //开始监控滚动栏scroll
        $(document).scroll(function(){
            //获取当前滚动栏scroll的高度并赋值
            var scrTop = $(window).scrollTop();
            //开始判断如果导航栏距离顶部的高度等于当前滚动栏的高度则开启悬浮
            if(scrTop >= top){
                $('#nav').css({'position':'fixed','top':'0','width':'100%'});
            }else{//否则清空悬浮
                $('#nav').css({'position':'','top':''});
            }
        })
    })
</script>
<script type="text/javascript">
    $(document).ready(function() {
        var temp = "none";

        $("#change_item_1").click(function () {
            openMatter(1);
        });
        $("#change_item_2").click(function () {
            openMatter(2);
        });
        function openMatter(obj) {
            for (var i = 1; i < 3; i++) {
                if (i == obj) {
                    temp = "block";
                } else {
                    temp = "none";
                }
                document.getElementById("order" + i).style.display = temp;

            }
        }
    });
</script>
<script>
    let user_id=GetQueryString("this_identity");
    let wand=$.cookie('this_token');
    let str1='';
    let str2='';
    let str3='';
    let str4='';
    let str5='';
    let str6='';
    $(document).ready(function(){
        $.ajax({
            url: 'http://localhost:8080/user/getUserInfo',//相对应的esb接口地址
            type: 'post',
            data: {"identity": user_id,"token":wand},//向服务器（接口）传递的参数
            success: function (data) {//服务器（接口）返回来的数据
                let obj = eval('(' + data + ')');
                if(obj.code==100){
                    str2='UserInfo.html?this_identity='+user_id;
                    str6='index.html?this_identity='+user_id;
                    str1+='<a href="'+str2+'">'
                    str1+='<div class="navbar-header" style="width: 60px; height: 60px;float: left">'
                    str1+='<img src="'+'http://www.lfork.top/blog/'+obj.data.headPortrait+'" style="height: 100%;width: 100%" class="img-circle">'
                    str1+='</div>'
                    str1+='<div style="width: 60px; height: 60px;float: left;line-height: 60px">'
                    str1+= '<span>'+user_id+'</span>'
                    str1+= '</div>'
                    str1+= '</a>'
                    str1+='<div class="nav_btn">'
                    str1+='<button type="button" class="btn btn-primary btn-block">写文章</button></div>'
                    str3=obj.data.nickname
                    str4=obj.data.sex
                    str5+='<img src="'+'http://www.lfork.top/blog/'+ obj.data.headPortrait+'" style="height: 100%;width: 100%" class="img-circle">'
                    $("#user_info").html(str1);
                    $("#index_id").attr("href",str6);
                    $("#nickname").attr("value",str3);
                    $("input:radio[value='"+str4+"']").attr('checked','true');
                    $("#head_img").html(str5);

                }else{
                }
            }
        })
    });
    $("#re_save").click(
        function () {
            let sex=$("input[name='sex']:checked").val();
            let nickname=$("#nickname").val();
            $.ajax({

                url: 'http://www.lfork.top/blog/user/updateUserInfo',//相对应的esb接口地址

                type: 'post',

                data: {"identity": user_id, "token":wand,"sex":sex,"nickname":nickname},//向服务器（接口）传递的参数

                success: function (data) {//服务器（接口）返回来的数据
                    let obj = eval('(' + data + ')');
                    if (obj.code == 100) {//如果返回来的信息说明提交的信息为正确的
                        let txt=  "修改个人信息成功";
                        window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.success);
                    }
                    else {//如果返回来的信息说明提供的信息为错误的
                        let txt=  "修改个人信息失败";
                        window.wxc.xcConfirm(txt, window.wxc.xcConfirm.typeEnum.error);

                    }
                }

            })
        }
    );
</script>
</html>